# –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–æ–≤

## –ü—Ä–æ–±–ª–µ–º—ã, –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –≤ –ª–æ–≥–µ (Untitled-2.lua)

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ #1: NullReferenceException –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ JobDef
**–°–∏–º–ø—Ç–æ–º—ã:**
- 617 –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–∫—Å—Ç—É—Ä
- NullReferenceException –≤ `Verse.ThingDef.ResolveIcon()`
- NullReferenceException –≤ `Verse.KeyBindingDef.get_JustPressed()`
- –ò–≥—Ä–∞ –∫—Ä–∞—à–∏—Ç—Å—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

**–ü—Ä–∏—á–∏–Ω–∞:**
–ü–∞—Ç—á–∏ —Å–æ–∑–¥–∞–≤–∞–ª–∏ –Ω–æ–≤—ã–µ `JobDef` –æ–±—ä–µ–∫—Ç—ã –Ω–∞–ø—Ä—è–º—É—é:
```csharp
var foodJobDef = new JobDef { defName = "Ingest" };  // ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
```

JobDefs –¥–æ–ª–∂–Ω—ã –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∏–∑ XML —á–µ—Ä–µ–∑ DefDatabase, –∞ –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ!

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- ‚úÖ –û—Ç–∫–ª—é—á—ë–Ω `Pawn_AI_Patch.GetQuickThought()`
- ‚úÖ –û—Ç–∫–ª—é—á—ë–Ω `Pawn_PathFollower_Patch.GetQuickJob()`
- ‚úÖ –û—Ç–∫–ª—é—á—ë–Ω `ThinkNode_Patch.TryIssueJobPackage_Prefix`
- ‚úÖ –û—Ç–∫–ª—é—á—ë–Ω `Pawn_JobTracker_Patch.DetermineNextJob_Prefix`

---

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ #2: –ù–∞—Ä—É—à–µ–Ω–∏–µ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏ Unity
**–°–∏–º–ø—Ç–æ–º—ã:**
- NullReferenceException –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ Unity –æ–±—ä–µ–∫—Ç–∞–º
- –û—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–∫—Å—Ç—É—Ä
- Race conditions –≤ –∏–≥—Ä–æ–≤–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏

**–ü—Ä–∏—á–∏–Ω–∞:**
–§–æ–Ω–æ–≤—ã–µ –ø–æ—Ç–æ–∫–∏ (`Task.Run`) –≤—ã–∑—ã–≤–∞–ª–∏ –º–µ—Ç–æ–¥—ã Unity:
```csharp
Task.Run(async () => {
    jobTracker.curDriver.DriverTick();  // ‚ùå Unity –æ–±—ä–µ–∫—Ç –≤ —Ñ–æ–Ω–æ–≤–æ–º –ø–æ—Ç–æ–∫–µ!
});
```

Unity –æ–±—ä–µ–∫—Ç—ã –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¢–û–õ–¨–ö–û –≤ –≥–ª–∞–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ!

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á—ë–Ω `ScheduleAsyncJobTick()`
- ‚úÖ –û—Ç–∫–ª—é—á—ë–Ω `Pawn_JobTracker_Patch.JobTrackerTick_Prefix`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–¥—Ä–æ–±–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è—Ö Unity

---

## –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **Source/RimAsync/Patches/RW_Patches/Pawn_AI_Patch.cs**
   - –û—Ç–∫–ª—é—á–µ–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ JobDef
   - –û—Ç–∫–ª—é—á—ë–Ω –ø–∞—Ç—á `TryIssueJobPackage_Prefix`

2. **Source/RimAsync/Patches/RW_Patches/Pawn_PathFollower_Patch.cs**
   - –û—Ç–∫–ª—é—á–µ–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ JobDef –≤ `GetQuickJob()`, `CreateFoodJob()`, `CreateRestJob()`
   - –û—Ç–∫–ª—é—á—ë–Ω –ø–∞—Ç—á `DetermineNextJob_Prefix`
   - –û—Ç–∫–ª—é—á—ë–Ω –ø–∞—Ç—á `JobTrackerTick_Prefix`
   - –û—Ç–∫–ª—é—á–µ–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ `DriverTick()` –≤ —Ñ–æ–Ω–æ–≤–æ–º –ø–æ—Ç–æ–∫–µ

3. **BUG_ANALYSIS.md** (–Ω–æ–≤—ã–π)
   - –ü–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º
   - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É—Ä–æ–∫–∏
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É

---

## –ü–∞—Ç—á–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—Å—ë –µ—â—ë —Ä–∞–±–æ—Ç–∞—é—Ç (–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ)

‚úÖ **Building_Patch.Tick_Prefix** - —Ç–æ–ª—å–∫–æ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç —Ñ–æ–Ω–æ–≤—É—é –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é
‚úÖ **Pawn_MindState_Patch.MindStateTick_Prefix** - —Ç–æ–ª—å–∫–æ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç —Ñ–æ–Ω–æ–≤—É—é –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é
‚úÖ **TickManager_Patch.DoSingleTick_Prefix** - —Ç–æ–ª—å–∫–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
‚úÖ **Map_Patch.MapPostTick_Prefix** - —Ç–æ–ª—å–∫–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
‚úÖ **Pawn_PathFollower_Patch.GeneratePatherPath_Prefix** - –≤—ã—á–∏—Å–ª—è–µ—Ç –ø—É—Ç—å –≤ –≥–ª–∞–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ

---

## –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

1. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å RimWorld
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ NullReferenceException –±–æ–ª—å—à–µ –Ω–µ—Ç
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ 617 –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–∫—Å—Ç—É—Ä –∏—Å—á–µ–∑–ª–∏

2. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –ø–æ–¥—Ö–æ–¥–∞:**
   - ‚ùå –ù–ï –≤—ã–ø–æ–ª–Ω—è—Ç—å –∏–≥—Ä–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –≤ —Ñ–æ–Ω–æ–≤—ã—Ö –ø–æ—Ç–æ–∫–∞—Ö
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–∏–π
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Postfix –ø–∞—Ç—á–∏ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
   - ‚úÖ –ü—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è, –Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å –∏—Ö –≤ –≥–ª–∞–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ

3. **–£–ª—É—á—à–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é:**
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ Settings –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –¥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ç—á–µ–π
   - –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ –Ω–∞ null –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É—Ä–æ–∫–∏

### ‚ùå –ß—Ç–æ –ù–ï–õ–¨–ó–Ø –¥–µ–ª–∞—Ç—å –≤ RimWorld –º–æ–¥–∞—Ö:
1. –°–æ–∑–¥–∞–≤–∞—Ç—å Defs (`JobDef`, `ThingDef`, –∏ —Ç.–¥.) –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ
2. –í—ã–∑—ã–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã Unity –∏–∑ —Ñ–æ–Ω–æ–≤—ã—Ö –ø–æ—Ç–æ–∫–æ–≤
3. –ü—Ä–æ–ø—É—Å–∫–∞—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã `SpawnSetup`/`DeSpawn`
4. –û–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –∏–≥—Ä–æ–≤–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é –∏–∑ `Task.Run()`

### ‚úÖ –ß—Ç–æ –ú–û–ñ–ù–û –¥–µ–ª–∞—Ç—å:
1. –§–æ–Ω–æ–≤—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ë–ï–ó Unity –æ–±—ä–µ–∫—Ç–æ–≤
2. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –≥–ª–∞–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ
3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
4. Postfix –ø–∞—Ç—á–∏ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞
5. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `LongEventHandler` –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ú–æ–¥ –ø—ã—Ç–∞–ª—Å—è –±—ã—Ç—å "—Å–ª–∏—à–∫–æ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º", –ø–µ—Ä–µ–º–µ—â–∞—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏–≥—Ä–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã –≤ —Ñ–æ–Ω–æ–≤—ã–µ –ø–æ—Ç–æ–∫–∏. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ RimWorld (Unity, –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω—ã–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª) —Ç—Ä–µ–±—É–µ—Ç –±–æ–ª–µ–µ –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:

- ‚úÖ Async –¥–ª—è **—Ç–æ–ª—å–∫–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π** (–±–µ–∑ Unity –æ–±—ä–µ–∫—Ç–æ–≤)
- ‚úÖ –ì–ª–∞–≤–Ω—ã–π –ø–æ—Ç–æ–∫ –¥–ª—è **–≤—Å–µ–≥–æ –∏–≥—Ä–æ–≤–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è**
- ‚úÖ Postfix –ø–∞—Ç—á–∏ –¥–ª—è **–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ—Å—Ç—Ñ–∞–∫—Ç—É–º**
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è **–ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —É–ª—É—á—à–µ–Ω–∏–π**

–≠—Ç–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –≤—Å–µ NullReferenceException –∏ –æ—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–∫—Å—Ç—É—Ä –∏–∑ –ª–æ–≥–∞.
