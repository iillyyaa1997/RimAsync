# üéØ –ù–ê–ô–î–ï–ù–ê –ù–ê–°–¢–û–Ø–©–ê–Ø –ü–†–ò–ß–ò–ù–ê! AppDomain.GetAssemblies()

## –ü—Ä–æ–±–ª–µ–º–∞

**–ë–µ–∑ –º–æ–¥–∞** - –æ—à–∏–±–æ–∫ –Ω–µ—Ç ‚úÖ
**–° –º–æ–¥–æ–º** - 620 –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–∫—Å—Ç—É—Ä ‚ùå

## –ü—Ä–∏—á–∏–Ω–∞ –Ω–∞–π–¥–µ–Ω–∞!

`MultiplayerCompat.Initialize()` –≤—ã–∑—ã–≤–∞–ª—Å—è –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –º–æ–¥–∞ –∏ –¥–µ–ª–∞–ª:

```csharp
foreach (var assembly in AppDomain.CurrentDomain.GetAssemblies())
{
    if (assembly.GetName().Name == "Multiplayer")
    {
        _multiplayerAssembly = assembly;
        break;
    }
}
```

### –ü–æ—á–µ–º—É —ç—Ç–æ –ª–æ–º–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É?

`AppDomain.CurrentDomain.GetAssemblies()` –≤–æ –≤—Ä–µ–º—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥–∞:

1. **–ó–∞—Å—Ç–∞–≤–ª—è–µ—Ç CLR –∑–∞–≥—Ä—É–∂–∞—Ç—å –í–°–ï —Å–±–æ—Ä–∫–∏** –¥—Ä—É–≥–∏—Ö –º–æ–¥–æ–≤ —Ä–∞–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏
2. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–ª–∞—Å—Å—ã** –¥—Ä—É–≥–∏—Ö –º–æ–¥–æ–≤ –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ
3. **–õ–æ–º–∞–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** –º–µ–∂–¥—É –º–æ–¥–∞–º–∏
4. **–í—ã–∑—ã–≤–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É —Ä–µ—Å—É—Ä—Å–æ–≤** –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –∏–≥—Ä–∞ –≥–æ—Ç–æ–≤–∞ –∏—Ö –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- –ú–æ–¥—ã —Å –∫–æ–≤—Ä–∞–º–∏ –ø—ã—Ç–∞—é—Ç—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ–∫—Å—Ç—É—Ä—ã, –Ω–æ —Å–∏—Å—Ç–µ–º–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ –Ω–µ –≥–æ—Ç–æ–≤–∞
- TerrainDef.PostLoad –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
- ContentFinder –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ —Ç–µ–∫—Å—Ç—É—Ä—ã, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
- 620 –æ—à–∏–±–æ–∫ "Could not load Texture2D"

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –î–æ (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):
```csharp
public RimAsyncMod(ModContentPack content) : base(content)
{
    _harmonyInstance = new Harmony("rimasync.mod");
    RimAsyncCore.Initialize(); // ‚ùå –í—ã–∑—ã–≤–∞–µ—Ç AppDomain.GetAssemblies()!
    _harmonyInstance.PatchAll();
}
```

### –ü–æ—Å–ª–µ (–ü–†–ê–í–ò–õ–¨–ù–û):
```csharp
public RimAsyncMod(ModContentPack content) : base(content)
{
    _harmonyInstance = new Harmony("rimasync.mod");
    // –ù–ï –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Core –∑–¥–µ—Å—å!
    _harmonyInstance.PatchAll(); // –ü–∞—Ç—á–∏ - –º–æ–∂–Ω–æ
}

public class RimAsyncGameComponent : GameComponent
{
    public RimAsyncGameComponent(Game game) : base(game)
    {
        // ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Core –ó–î–ï–°–¨!
        // GameComponent —Å–æ–∑–¥–∞—ë—Ç—Å—è –∫–æ–≥–¥–∞ –≤—Å–µ –º–æ–¥—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã
        RimAsyncCore.Initialize();
    }
}
```

## –ü–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ RimWorld

1. **Mod constructors** ‚Üê –†–∞–Ω—å—à–µ —Ç—É—Ç –±—ã–ª–æ `RimAsyncCore.Initialize()` ‚ùå
   - –ú–Ω–æ–≥–∏–µ –º–æ–¥—ã –µ—â—ë –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
   - –†–µ—Å—É—Ä—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –≥–æ—Ç–æ–≤–∞
   - AppDomain.GetAssemblies() –ª–æ–º–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É

2. **Def loading + PostLoad** ‚Üê –ü—Ä–æ–±–ª–µ–º—ã —Å —Ç–µ–∫—Å—Ç—É—Ä–∞–º–∏ –ø–æ—è–≤–ª—è–ª–∏—Å—å –∑–¥–µ—Å—å
   - –î—Ä—É–≥–∏–µ –º–æ–¥—ã –ø—ã—Ç–∞—é—Ç—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ–∫—Å—Ç—É—Ä—ã
   - –ù–æ –∏—Ö —Å–±–æ—Ä–∫–∏ —É–∂–µ –∏—Å–ø–æ—Ä—á–µ–Ω—ã –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π

3. **GameComponent creation** ‚Üê –¢–µ–ø–µ—Ä—å —Ç—É—Ç `RimAsyncCore.Initialize()` ‚úÖ
   - –í—Å–µ –º–æ–¥—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∂–µ–Ω—ã
   - –†–µ—Å—É—Ä—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞
   - AppDomain.GetAssemblies() –±–µ–∑–æ–ø–∞—Å–µ–Ω

4. **Game start**

## –ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ

### 1. RimAsyncMod.cs
- **–£–±—Ä–∞–Ω–∞** –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è `RimAsyncCore.Initialize()` –∏–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞
- –ü–∞—Ç—á–∏ Harmony –æ—Å—Ç–∞—é—Ç—Å—è (–æ–Ω–∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã)
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ –ø—Ä–æ–±–ª–µ–º–µ

### 2. RimAsyncGameComponent.cs
- **–î–æ–±–∞–≤–ª–µ–Ω–∞** –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è `RimAsyncCore.Initialize()` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
- –¢–µ–ø–µ—Ä—å Core –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ü–û–°–õ–ï –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä—ã

### 3. RimAsyncInitializer.cs
- –û—Ç–∫–ª—é—á—ë–Ω StaticConstructorOnStartup (–ø—Ä–µ–¥—ã–¥—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞)

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### AppDomain.GetAssemblies() - –æ–ø–∞—Å–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è!

–ö–æ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–æ–≤:
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ**: –ü–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä—ã (GameComponent)
- ‚ö†Ô∏è **–û–ø–∞—Å–Ω–æ**: –í Mod constructor
- ‚ùå **–û—á–µ–Ω—å –æ–ø–∞—Å–Ω–æ**: –í StaticConstructorOnStartup

### –ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ —Ç–µ–∫—Å—Ç—É—Ä—ã?

1. RimAsync –≤—ã–∑—ã–≤–∞–µ—Ç `GetAssemblies()` —Ä–∞–Ω–æ
2. CLR –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–±–æ—Ä–∫–∏ –º–æ–¥–æ–≤ —Å –∫–æ–≤—Ä–∞–º–∏/pollution
3. –ò—Ö —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è
4. –û–Ω–∏ –ø—ã—Ç–∞—é—Ç—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å Defs –∏ —Ç–µ–∫—Å—Ç—É—Ä—ã
5. –ù–æ `ContentFinder` –µ—â—ë –Ω–µ –≥–æ—Ç–æ–≤
6. ‚Üí "Could not load Texture2D"

## –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ –¢–µ–∫—Å—Ç—É—Ä—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ "Could not load Texture2D"
- ‚úÖ –ù–µ—Ç NullReferenceException
- ‚úÖ RimAsync –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–Ω–æ –ø–æ–∑–∂–µ)
- ‚úÖ MultiplayerCompat —Ä–∞–±–æ—Ç–∞–µ—Ç (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤—Ä–µ–º—è)

## –¢–µ—Å—Ç

1. **–ü–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä–æ–π RimWorld**
2. **–û—á–∏—Å—Ç–∏ –∫—ç—à:**
```bash
rm -rf ~/Library/Caches/com.ludeon.rimworld
```
3. **–ó–∞–ø—É—Å—Ç–∏ –∏–≥—Ä—É —Å RimAsync**
4. **–°–æ–∑–¥–∞–π –Ω–æ–≤—É—é –∏–≥—Ä—É**

–í –ª–æ–≥–µ –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è —Å—Ç—Ä–æ–∫–∞:
```
[RimAsync] Initializing RimAsync core systems from GameComponent
```

–ò –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ —Ç–µ–∫—Å—Ç—É—Ä!

## –£—Ä–æ–∫

**–ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π `AppDomain.GetAssemblies()` –≤ Mod constructor!**

–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –º–µ—Å—Ç–∞ –¥–ª—è —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏:
- ‚úÖ GameComponent constructor
- ‚úÖ –ü–æ—Å–ª–µ –∏–≥—Ä–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∂–µ–Ω–∞
- ‚úÖ –í –æ—Ç–≤–µ—Ç –Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è –∏–≥—Ä–æ–∫–∞

–û–ø–∞—Å–Ω—ã–µ –º–µ—Å—Ç–∞:
- ‚ùå Mod constructor
- ‚ùå StaticConstructorOnStartup
- ‚ùå –í–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ Defs

---

**–í—Ä–µ–º—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏:** ~17:00 02.11.2025

–ü—Ä–æ–≤–µ—Ä—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –¥–∞–π –∑–Ω–∞—Ç—å!
