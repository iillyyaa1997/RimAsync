# –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: StaticConstructorOnStartup –ª–æ–º–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –∏–≥—Ä—ã

## üî¥ –†–µ–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º)

**–û—à–∏–±–∫–∏ –ø–æ—è–≤–∏–ª–∏—Å—å –¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ –≤–∫–ª—é—á–µ–Ω–∏—è RimAsync!**

## –ü—Ä–∏—á–∏–Ω–∞

### –ß—Ç–æ –±—ã–ª–æ –Ω–µ —Ç–∞–∫:
```csharp
[StaticConstructorOnStartup]  // ‚ùå –≠—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ü–†–Ø–ú–û –í–û –í–†–ï–ú–Ø PostLoad!
public static class RimAsyncInitializer
{
    static RimAsyncInitializer() {
        HarmonyInstance.PatchAll();  // ‚ùå –ü–∞—Ç—á–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ Defs!
    }
}
```

### Stack trace –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É:
```
Verse.TerrainDef:<PostLoad>b__118_0 ()        ‚Üê Def –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
Verse.LongEventHandler:ExecuteToExecuteWhenFinished ()
```

**RimAsync –ø—Ä–∏–º–µ–Ω—è–ª Harmony –ø–∞—Ç—á–∏ –ü–†–Ø–ú–û –í–û –í–†–ï–ú–Ø –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `TerrainDef.PostLoad()`!**

–≠—Ç–æ –ª–æ–º–∞–ª–æ:
- –ó–∞–≥—Ä—É–∑–∫—É —Ç–µ–∫—Å—Ç—É—Ä (622 –æ—à–∏–±–∫–∏)
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é MaterialPool
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é GraphicDatabase
- –í—Å–µ TerrainDef, ThingDef, –∏ –¥—Ä—É–≥–∏–µ Defs

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ü–µ—Ä–µ–º–µ—Å—Ç–∏–ª–∏ –ø–∞—Ç—á–∏ –æ–±—Ä–∞—Ç–Ω–æ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä Mod:
```csharp
public RimAsyncMod(ModContentPack content) : base(content)
{
    // ‚úÖ –ü–∞—Ç—á–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ó–î–ï–°–¨ - –î–û –∑–∞–≥—Ä—É–∑–∫–∏ Defs
    _harmonyInstance.PatchAll();
}
```

**–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä Mod –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –†–ê–ù–¨–®–ï, —á–µ–º –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∫–∞ Defs!**

–ü–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ RimWorld:
1. ‚úÖ **Mod constructors** ‚Üê –ü–∞—Ç—á–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∑–¥–µ—Å—å (–±–µ–∑–æ–ø–∞—Å–Ω–æ)
2. ‚ùå **Def loading + PostLoad** ‚Üê StaticConstructorOnStartup –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∑–¥–µ—Å—å (–æ–ø–∞—Å–Ω–æ!)
3. **Game initialization**

## –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. RimAsyncInitializer.cs
- **–û–¢–ö–õ–Æ–ß–ï–ù** `[StaticConstructorOnStartup]`
- –ö–ª–∞—Å—Å –æ—Å—Ç–∞–≤–ª–µ–Ω –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏, –Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ –ø—Ä–æ–±–ª–µ–º–µ

### 2. RimAsyncMod.cs
- –ü–∞—Ç—á–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è **–≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ `RIMASYNC_SKIP_HARMONY`
- –î–æ–±–∞–≤–ª–µ–Ω try-catch –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
‚ùå 622 –æ—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–∫—Å—Ç—É—Ä
‚ùå NullReferenceException –≤ ThingDef.ResolveIcon
‚ùå NullReferenceException –≤ KeyBindingDef.get_JustPressed
‚ùå MatFrom with null sourceTex (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ)
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–æ–∂–∏–¥–∞–µ—Ç—Å—è):
```
‚úÖ –í—Å–µ —Ç–µ–∫—Å—Ç—É—Ä—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
‚úÖ –ù–µ—Ç NullReferenceException
‚úÖ RimAsync —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
‚úÖ –î—Ä—É–≥–∏–µ –º–æ–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ
```

## –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

1. **–£–¥–∞–ª–∏ —Å—Ç–∞—Ä—ã–π –ª–æ–≥:**
   ```bash
   rm ~/Library/Application\ Support/RimWorld/Player.log
   ```

2. **–ó–∞–ø—É—Å—Ç–∏ RimWorld —Å RimAsync**

3. **–ü—Ä–æ–≤–µ—Ä—å –Ω–æ–≤—ã–π –ª–æ–≥:**
   - –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞: `[RimAsync] Applying Harmony patches` (–≤ –Ω–∞—á–∞–ª–µ)
   - –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å: `Could not load Texture2D`
   - –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å: `MatFrom with null sourceTex`

4. **–°–æ–∑–¥–∞–π –Ω–æ–≤—É—é –∏–≥—Ä—É** - –¥–æ–ª–∂–Ω–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ

`[StaticConstructorOnStartup]` - —ç—Ç–æ –∞—Ç—Ä–∏–±—É—Ç RimWorld, –∫–æ—Ç–æ—Ä—ã–π –≥–æ–≤–æ—Ä–∏—Ç:
> "–í—ã–∑–æ–≤–∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö Defs"

–ù–æ **"–ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏"** –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –æ–∑–Ω–∞—á–∞–µ—Ç **"–≤–æ –≤—Ä–µ–º—è PostLoad —Ñ–∞–∑—ã"**!

–ö–æ–≥–¥–∞ RimWorld –∑–∞–≥—Ä—É–∂–∞–µ—Ç Defs:
1. –ü–∞—Ä—Å–∏—Ç XML ‚Üí —Å–æ–∑–¥–∞—ë—Ç Def –æ–±—ä–µ–∫—Ç—ã
2. –í—ã–∑—ã–≤–∞–µ—Ç `Def.PostLoad()` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ Def
3. **–í–û –í–†–ï–ú–Ø –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è PostLoad** –≤—ã–∑—ã–≤–∞—é—Ç—Å—è StaticConstructorOnStartup –∫–ª–∞—Å—Å—ã
4. –ó–∞–≤–µ—Ä—à–∞–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é Defs

–ù–∞—à–∏ Harmony –ø–∞—Ç—á–∏ –Ω–∞ `Thing`, `Pawn`, `TickManager` –∏ —Ç.–¥. **–º–µ—à–∞–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é PostLoad**!

## –í–∞–∂–Ω—ã–π —É—Ä–æ–∫

### ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π StaticConstructorOnStartup –¥–ª—è:
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏—è Harmony –ø–∞—Ç—á–µ–π
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º, –∫–æ—Ç–æ—Ä—ã–µ –≤–ª–∏—è—é—Ç –Ω–∞ Defs

### ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π StaticConstructorOnStartup –¥–ª—è:
- –°–æ–∑–¥–∞–Ω–∏—è –∫—ç—à–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö Defs
- –ü—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–∏–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º DefDatabase
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö, –∑–∞–≤–∏—Å—è—â–∏—Ö –æ—Ç Defs

### ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π Mod constructor –¥–ª—è:
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏—è Harmony –ø–∞—Ç—á–µ–π (–í–°–ï–ì–î–ê!)
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥–æ–≤
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ö—É–∫–æ–≤

## –°—Ç–∞—Ç—É—Å

- ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ
- ‚úÖ –ö–æ–¥ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –ú–æ–¥ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –∏–≥—Ä—É
- ‚è≥ –¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∏–≥—Ä–µ

## –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

**–ó–∞–ø—É—Å—Ç–∏ RimWorld –∏ –ø—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –æ—à–∏–±–∫–∏ –∏—Å—á–µ–∑–ª–∏!** [[memory:10654111]]

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞–ª–∏—Å—å - –ø—Ä–∏—à–ª–∏ –Ω–æ–≤—ã–π –ª–æ–≥.
